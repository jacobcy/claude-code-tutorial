# Claude Code 从零到一完整指南

欢迎来到 Claude Code 从零到一的完整学习教程！本项目旨在帮助开发者掌握 Claude Code 的使用方法，特别是并行工作和安全操作。

## 目录

1. [简介](#简介)
2. [安装和配置](#安装和配置)
3. [基础概念](#基础概念)
4. [并行工作实践](#并行工作实践)
5. [安全操作准则](#安全操作准则)
6. [最佳实践](#最佳实践)

## 简介

Claude Code 是一个强大的 AI 辅助编程工具，允许开发者与 Claude AI 进行深入的代码交互。本教程将引导你从零开始学习如何有效且安全地使用 Claude Code。

## 安装和配置

### 先决条件

- Git (版本控制)
- Node.js (如果使用 CLI 版本)
- Ghostty 终端 (推荐)
- Lazygit (推荐用于可视化 Git 操作)

### 安装 Claude Code

```bash
npm install -g @anthropic-ai/code
```

## 基础概念

### 核心原则

1. **单一职责**: 每个 AI 代理只负责一个特定任务
2. **隔离环境**: 每个任务使用独立的工作树
3. **可见性**: 所有更改都应在你的监控之下

### 工作树 (Worktree) 概念

Git 工作树允许你在物理上分离的目录中工作，但共享同一个仓库历史。这对于并行使用 Claude Code 至关重要。

```bash
# 从主分支创建一个工作树
git worktree add ../project-feature-a feature/feature-a
```

## 并行工作实践

### 设置并行工作环境

1. **为主任务保留主窗口**:
   - Tab 1: main (审查/合并)

2. **为每个 Claude 任务创建独立窗口**:
   - Tab 2: Claude 任务 A
   - Tab 3: Claude 任务 B

3. **为每个任务创建独立的工作树**:
   ```bash
   git worktree add ../my-project-feature-a feature-a
   git worktree add ../my-project-feature-b feature-b
   ```

### 任务定义文件 (TASK.md)

每个 Claude 任务都应该有明确定义的任务文件：

```markdown
# TASK.md
目标:
实现用户认证功能

约束:
- 不添加新的外部依赖
- 不修改现有的公共 API
- 必须包含单元测试
- 遵循现有代码风格
```

### 代理规则文件 (AGENT_RULES.md)

为 Claude 提供明确的操作规则：

```markdown
# AGENT_RULES.md
## 操作约束

1. 只修改与分配任务直接相关的文件
2. 不要重构或重新格式化无关代码
3. 不要更改全局配置、依赖项或工具（除非明确指示）
4. 保持更改小而增量
5. 在编写代码之前解释你计划更改的内容

## 工作流程

1. 仔细阅读 TASK.md
2. 提出具体计划
3. 如果范围不明确，等待确认
4. 实施解决方案
5. 完成任务后停止
```

## 安全操作准则

### 核心安全规则

1. **绝不让 Claude 触碰 main 分支**
2. **绝不为单个代理分配多个任务**
3. **未经审查绝不合并**

### 审查和回滚

好的更改：
```bash
git commit -m "feat: implement user auth"
```

不良更改：
```bash
git reset --hard  # 回滚所有更改
```

记住：回滚是廉价的，必要时使用它。

## 最佳实践

### 1. 实时监控更改

在每个工作树中运行 `lazygit` 以实时查看差异：
- 监控实时差异
- 检测范围蔓延
- 决定提交还是回滚

### 2. 狭窄的任务范围

为 Claude 分配明确、狭窄的任务：
- 一次专注于一个功能
- 避免复杂的需求变更
- 将大型任务分解为更小的部分

### 3. 观察所有变化

确保你能看到所有更改，否则你就失去了对过程的控制。

---

在接下来的章节中，我们将通过实际示例展示这些概念的应用。