# Claude Code 最佳实践与安全准则

## 安全操作清单

### 开始之前 ✅
- [ ] 确认 Claude 在独立的工作树中运行
- [ ] 确认没有直接在 main 分支上运行 Claude
- [ ] 确认任务边界清晰明确
- [ ] 确认有实时监控工具 (如 lazygit) 准备就绪

### 任务定义阶段 ✅
- [ ] 创建清晰的 TASK.md 文件
- [ ] 定义明确的成功标准
- [ ] 设置合理的约束条件
- [ ] 准备 AGENT_RULES.md 限制操作范围

### Claude 运行期间 ✅
- [ ] 在单独的终端窗口运行
- [ ] 实时监控代码更改
- [ ] 确保 Claude 专注于单一任务
- [ ] 防止范围蔓延

### 任务完成后 ✅
- [ ] 审查所有更改
- [ ] 运行测试确认功能正常
- [ ] 确认没有引入安全问题
- [ ] 合理提交更改或必要时回滚

## 并行工作最佳实践

### 环境设置
1. **为每个任务创建独立的工作树**
2. **使用独立的终端窗口**
3. **确保任务间没有依赖冲突**
4. **定期同步主分支**

### 任务管理
1. **任务定义要足够具体**
2. **保持任务小而专注**
3. **设定明确的验收标准**
4. **及时沟通和协调**

### 质量控制
1. **代码审查不能省略**
2. **测试覆盖率要达标**
3. **遵循代码规范**
4. **性能要求要满足**

## 常见陷阱及防范

### 陷阱1: 任务范围蔓延
**症状**: Claude 开始修改与当前任务无关的文件
**防范**: 使用明确的 AGENT_RULES.md，持续监控

### 陷阱2: 多个任务冲突
**症状**: 并行开发的功能互相影响
**防范**: 清晰的模块划分，定期同步和测试

### 陷阱3: 缺乏监督
**症状**: 发现问题时已经做了大量无效工作
**防范**: 实时监控，小步快跑，频繁检查

### 陷阱4: 安全漏洞
**症状**: 引入硬编码的密钥或其他安全风险
**防范**: 安全审查，使用专门的工具扫描

## 故障排除

### 如果 Claude 做了不该做的更改
1. 立即停止 Claude
2. 使用 `git status` 和 `git diff` 查看更改
3. 必要时使用 `git reset --hard` 回滚
4. 重新定义更严格的 AGENT_RULES.md

### 如果并行任务出现冲突
1. 暂停受影响的工作
2. 分析冲突原因
3. 协调任务边界
4. 重新同步分支

### 如果不确定更改是否正确
1. 使用 `lazygit` 详细查看更改
2. 在单独的环境中测试
3. 请同事进行人工审查
4. 分步骤验证

## 高级技巧

### 1. 工作树生命周期管理
```
创建 → 开发 → 测试 → 合并 → 清理
```

### 2. 自动化辅助工具
- 使用 pre-commit hooks
- 设置自动化测试
- 使用代码质量检查工具

### 3. 团队协作
- 共享 TASK.md 和 AGENT_RULES.md 模板
- 建立团队规范
- 定期回顾和改进流程

## 工具推荐

### 必备工具
- `git` - 版本控制
- `lazygit` - 可视化 Git 操作
- `Ghostty` - 推荐的终端模拟器

### 辅助工具
- 代码编辑器（支持 Git 集成）
- 测试框架
- 代码质量检查工具
- 依赖管理工具

记住：Claude Code 的强大在于其效率，但安全和质量完全取决于你的操作方式。始终保持谨慎、监督和验证。